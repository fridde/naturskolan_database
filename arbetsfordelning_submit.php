<?php     /* PREAMBLE */    $url = "https://raw.githubusercontent.com/fridde/friddes_php_functions/master/include.php";    $filename = "include.php";    copy($url, $filename);    include $filename;    /* END OF PREAMBLE */			$insertArray = array();	$data = $_REQUEST["data"];	$aktivitetArray = $_REQUEST["aktivitet"];	$delete = $_REQUEST["delete"];	inc("fnc,sql,cal");		$ini_array = parse_ini_file("config.ini", TRUE);		if($_REQUEST["key"] == $ini_array["security"]["api_key"]){				foreach($data as $day => $dayContent){			foreach($dayContent as $aktivitet => $personalArray){				$criteria = array("AND", array("dag" => $day, "aktivitet" => $aktivitet));				$matchingLines = sql_select("arbetsfordelning", $criteria);				$shortPersonalArray = array();				foreach($personalArray as $personal){					$shortPersonalArray[] = substr($personal, 0, 1); 				}				$personalString = implode("+", $shortPersonalArray);				if(count($matchingLines) == 0){					$newEntry = array();					$newEntry["dag"] = $day;					$newEntry["aktivitet"] = $aktivitet;					$newEntry["personal"] = $personalString;					$insertArray[] = $newEntry;				}				else{					$matchingLine = reset($matchingLines);					$row["aktivitet"] = $aktivitet;					$row["personal"] = $personalString;					sql_update_row($matchingLine["id"], "arbetsfordelning", $row);				}			}		}		if(count($insertArray) > 0){			sql_insert_rows("arbetsfordelning", $insertArray);		}		if(isset($delete)){			foreach($delete as $date => $dateContent){				//echo gettype($type);				foreach($dateContent as $aktivitet => $value){					if($value == "true"){						$criteria = array("AND", array("dag" => $date, "aktivitet" => $aktivitet));						sql_delete("arbetsfordelning", $criteria);					}				}			}		}		update_calendar_db();		convert_database_to_ics("kalender");		redirect("arbetsfordelning.php");	}	else {		echo 'You did not provide the right API-key. Check your URL for the "key"-parameter.';	}//echo print_r($_REQUEST);